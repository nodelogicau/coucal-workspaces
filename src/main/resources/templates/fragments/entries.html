<!--
     Copyright 2025 Node Logic

     Licensed under the Apache License, Version 2.0 (the "License");
     you may not use this file except in compliance with the License.
     You may obtain a copy of the License at

         http://www.apache.org/licenses/LICENSE-2.0

     Unless required by applicable law or agreed to in writing, software
     distributed under the License is distributed on an "AS IS" BASIS,
     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     See the License for the specific language governing permissions and
     limitations under the License.
-->

<!doctype html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <script src="https://cdn.tailwindcss.com"></script>
    <title></title>
</head>

<body>

<div th:fragment="listContent" id="content-list">
    <div th:replace="~{::contentView}"></div>
</div>

<div th:fragment="contentView" id="content-view">
    <div class="relative overflow-x-auto sm:rounded-lg">

        <div id="delete-modal" tabindex="-1" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
            <div class="relative p-4 w-full max-w-md max-h-full">
                <div class="relative bg-white rounded-lg shadow-sm dark:bg-gray-700">
                    <button type="button" class="absolute top-3 end-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white" data-modal-hide="delete-modal">
                        <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                        </svg>
                        <span class="sr-only">Close modal</span>
                    </button>
                    <div class="p-4 md:p-5 text-center">
                        <svg class="mx-auto mb-4 text-gray-400 w-12 h-12 dark:text-gray-200" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 11V6m0 8h.01M19 10a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
                        </svg>
                        <h3 class="mb-5 text-lg font-normal text-gray-500 dark:text-gray-400">Are you sure you want to delete this product?</h3>
                        <button data-modal-hide="delete-modal" type="button" class="text-white bg-red-600 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 dark:focus:ring-red-800 font-medium rounded-lg text-sm inline-flex items-center px-5 py-2.5 text-center">
                            Yes, I'm sure
                        </button>
                        <button data-modal-hide="delete-modal" type="button" class="py-2.5 px-5 ms-3 text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-4 focus:ring-gray-100 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700">No, cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <table th:replace="~{fragments/ui/table::default('entries', ~{::tbody#rows})}">
            <tbody id="rows">
<!--                <tr th:each="node : ${content}" class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 border-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600">-->
                <tr th:each="node : ${content}">
<!--                    <th scope="row" class="px-3 py-2 font-medium text-gray-900 whitespace-nowrap dark:text-white">-->
                    <th scope="row">
                        <a href="#" th:href="|/view/${node.components[0].propertyList.getRequired('CONCEPT').value}/${node.uid.value}|">
                            <span th:replace="~{::renderContent(${node})}">Node 1</span>
                        </a>
                    </th>
                    <td>
                        Hotspur Way
                    </td>
                    <td>
                        <span th:replace="~{/fragments/ui/badge::default('Lifestyle')}"></span>
                    </td>
                    <td th:text="${dateFormatter.format(node.components[0].propertyList.getRequired('DTSTAMP').date)}">
                        Today
                    </td>
                    <td>
                        <span th:replace="~{/fragments/ui/badge::default('Tentative')}"></span>
                    </td>
                    <td class="text-right" nowrap>
                        <a th:href="|/edit/${node.components[0].propertyList.getRequired('CONCEPT').value}/${node.uid.value}|"
                           href="#" class="font-medium text-blue-600 dark:text-blue-500 hover:underline">Edit</a> |
                        <button
                                data-modal-target="delete-modal" data-modal-toggle="delete-modal"
                                class="font-medium text-blue-600 dark:text-blue-500 hover:underline">Delete</button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<div th:fragment="addContent(collection)" th:replace="~{fragments/ui/container::card(~{::form#add-content})}">
    <form id="add-content"
          th:hx-post="|/entries/${collection}/|" hx-target="#content-view"
          hx-on::after-request="if(event.detail.successful) this.reset()">
        <label>
            <select id="typeSelect" name="concept" onchange="toggleInputs()">
                <option disabled selected value> -- select a type -- </option>
                <optgroup label="Actions">
                    <option value="semcal:concept:action">Action</option>
                    <option value="semcal:concept:action">Agenda</option>
                    <option value="semcal:concept:action">Milestone</option>
                    <option value="semcal:concept:action">Project</option>
                    <option value="semcal:concept:action">Review</option>
                    <option value="semcal:concept:action">Task</option>
                </optgroup>
                <optgroup label="Availability">
                    <option value="semcal:concept:availability">Availability</option>
                    <option value="semcal:concept:availability">Offer</option>
                    <option value="semcal:concept:availability">Office Hours</option>
                    <option value="semcal:concept:availability">Out Of Office</option>
                </optgroup>
                <optgroup label="Events">
                    <option value="semcal:concept:event">Event</option>
                    <option value="semcal:concept:event">Appointment</option>
                    <option value="semcal:concept:event">Conference</option>
                    <option value="semcal:concept:event">Fixture</option>
                    <option value="semcal:concept:event">Meeting</option>
                    <option value="semcal:concept:event">Performance</option>
                    <option value="semcal:concept:event">Seminar</option>
                </optgroup>
                <optgroup label="Issues">
                    <option value="semcal:concept:issue">Issue</option>
                    <option value="semcal:concept:issue">Incident</option>
                    <option value="semcal:concept:issue">Improvement</option>
                    <option value="semcal:concept:issue">Risk</option>
                </optgroup>
                <optgroup label="Notes">
                    <option value="semcal:concept:note">Note</option>
                    <option value="semcal:concept:note">Assumption</option>
                    <option value="semcal:concept:note">Comment</option>
                    <option value="semcal:concept:note">Decision</option>
                    <option value="semcal:concept:note">DefinedTerms</option>
                    <option value="semcal:concept:note">Objective</option>
                </optgroup>
                <optgroup label="Observances">
                    <option value="semcal:concept:observance">Observance</option>
                    <option value="semcal:concept:observance">Anniversary</option>
                    <option value="semcal:concept:observance">Reservation</option>
                    <option value="semcal:concept:observance">Sprint</option>
                    <option value="semcal:concept:observance">Subscription</option>
                </optgroup>
                <optgroup label="Reports">
                    <option value="semcal:concept:report">Report</option>
                    <option value="semcal:concept:report">Attendance</option>
                    <option value="semcal:concept:report">Budget</option>
                    <option value="semcal:concept:report">Expense</option>
                    <option value="semcal:concept:report">Timesheet</option>
                </optgroup>
                <optgroup label="Requests">
                    <option value="semcal:concept:request">Request</option>
                    <option value="semcal:concept:request">Approval</option>
                    <option value="semcal:concept:request">Fault</option>
                    <option value="semcal:concept:request">Order</option>
                </optgroup>
                <optgroup label="Resources">
                    <option value="semcal:concept:resources">Resource</option>
                    <option value="semcal:concept:resources">Application</option>
                    <option value="semcal:concept:resources">Book</option>
                    <option value="semcal:concept:resources">Collection</option>
                    <option value="semcal:concept:resources">ConfigurationItem</option>
                    <option value="semcal:concept:resources">Property</option>
                    <option value="semcal:concept:resources">WebSite</option>
                </optgroup>
            </select>
            <script>
                function toggleInputs() {
                    if (['semcal:concept:event','semcal:concept:observance','semcal:concept:availability'].includes(document.getElementById('typeSelect').value)) {
                        document.getElementById('startDate').style.display = 'inline';
                    } else {
                        document.getElementById('startDate').style.display = 'none';
                    }

                    if (['semcal:concept:availability'].includes(document.getElementById('typeSelect').value)) {
                        document.getElementById('endDate').style.display = 'inline';
                    } else {
                        document.getElementById('endDate').style.display = 'none';
                    }

                    if (['semcal:concept:event'].includes(document.getElementById('typeSelect').value)) {
                        document.getElementById('duration').style.display = 'inline';
                    } else {
                        document.getElementById('duration').style.display = 'none';
                    }

                    if (['semcal:concept:action'].includes(document.getElementById('typeSelect').value)) {
                        document.getElementById('due').style.display = 'inline';
                    } else {
                        document.getElementById('due').style.display = 'none';
                    }

                    if (['semcal:concept:event','semcal:concept:observance','semcal:concept:report',
                        'semcal:concept:availability'].includes(document.getElementById('typeSelect').value)) {
                        document.getElementById('repeats').style.display = 'inline';
                    } else {
                        document.getElementById('repeats').style.display = 'none';
                    }

                    if (['semcal:concept:note','semcal:concept:resources'].includes(document.getElementById('typeSelect').value)) {
                        document.getElementById('link').style.display = 'inline';
                    } else {
                        document.getElementById('link').style.display = 'none';
                    }
                }
            </script>
        </label>
        <label>
            <input name="summary" placeholder="Summary.." size="64" required>
        </label>
        <button type="submit" th:replace="~{fragments/ui/button::submit('Add')}">Add</button>
        <a href="#">More..</a>
        <br/>
        <label id="startDate">
            Start
            <input type="date" name="dtstart">
        </label>
        <label id="endDate">
            End
            <input type="date" name="dtend">
        </label>
        <label id="duration">
            <select name="duration">
                <option disabled selected value>Select duration..</option>
                <option value="PT30M">30m</option>
                <option value="PT1H">1h</option>
                <option value="PT1H30M">1.5h</option>
                <option value="PT2H">2h</option>
            </select>
        </label>
        <label id="due">
            Due
            <input type="datetime-local" name="due">
        </label>
        <label id="repeats">
            Repeats
            <select name="rrule">
                <option disabled selected value>Select recurrence..</option>
                <option value="FREQ=DAILY">Daily</option>
                <option value="FREQ=WEEKLY">Weekly</option>
                <option value="FREQ=WEEKLY;INTERVAL=2">Fortnightly</option>
                <option value="FREQ=MONTHLY">Monthly</option>
                <option value="FREQ=YEARLY">Annually</option>
            </select>
        </label>
        <label id="link">
            <input type="url" name="link[value:uri]" placeholder="Link.." size="64">
        </label>
    </form>
</div>

<div th:fragment="renderContent(entry)" class="flex">
<!--    <img th:replace="~{ical4j/fragments/component/concept::icon(${entry.Components[0]})}">-->
    <img th:replace="~{/fragments/ui/icon::action}">
    <th:block th:replace="~{ical4j/fragments/component/summary::text(${entry.Components[0]})}" class="dark:text-gray-400 dark:hover:text-white">Content</th:block>
</div>
</body>
</html>
